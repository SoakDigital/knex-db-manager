(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{169:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[e("p",[e("a",{attrs:{href:"https://travis-ci.org/Vincit/knex-db-manager",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://travis-ci.org/Vincit/knex-db-manager.svg?branch=master",alt:"Build Status"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://coveralls.io/github/Vincit/knex-db-manager?branch=master",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://coveralls.io/repos/github/Vincit/knex-db-manager/badge.svg?branch=master",alt:"Coverage Status"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://greenkeeper.io/",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://badges.greenkeeper.io/Vincit/knex-db-manager.svg",alt:"Greenkeeper badge"}}),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("Pretty useful when writing scripts to initialize database for fresh install or\ndropping / creating new database when running tests and for truncating database\nbetween tests.")]),t._v(" "),e("p",[t._v("Library uses knex connection for non administrative queries, but also creates\npriviliged connection directly with driver with superuser privileges for creating\nand dropping databases / roles.")]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),e("p",[t._v("Clones database to another name remotely on db serverside (may be useful e.g.\nto make backup before running migrations).")]),t._v(" "),t._m(27),t._v(" "),e("p",[t._v("Note: This method is not supported with MySQL (yet).")]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._m(30),t._v(" "),e("p",[t._v("Truncate tables of the database and reset corresponding id sequences.")]),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._m(36),t._v(" "),t._m(37),t._v(" "),e("p",[t._v("This was motivated by some people who liked to create test data with\nhard coded ids, so this helps them to make app to work normally after\nadding rows to tables, which has not used id sequence to get ids.")]),t._v(" "),t._m(38),t._v(" "),e("p",[t._v("Note: This method is not supported with MySQL (yet).")]),t._v(" "),t._m(39),t._v(" "),t._m(40),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._m(46),t._v(" "),t._m(47),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._m(52),t._v(" "),e("p",[t._v("Checks which migrations has been ran to database.")]),t._v(" "),e("p",[t._v("Expects that migration name starts with timestamp.")]),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._m(56),t._v(" "),e("p",[t._v("Closes the single privileged connection to database server.")]),t._v(" "),t._m(57),t._v(" "),t._m(58),t._m(59),t._v(" "),e("p",[t._v("Closes knex connection which is made to the database for unprivileged\nqueries. Sometimes this is needed e.g. for being able to drop database.")]),t._v(" "),t._m(60),t._v(" "),t._m(61),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"supported-databases"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#supported-databases","aria-hidden":"true"}},[this._v("#")]),this._v(" Supported Databases")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("PostgreSQL")]),t._v(" "),e("li",[t._v("MySQL")]),t._v(" "),e("li",[e("s",[t._v("SQLite3 (TBD even though most of the functions won't make sense with this)")])]),t._v(" "),e("li",[e("s",[t._v("Oracle DB Express (TBD)")])]),t._v(" "),e("li",[e("s",[t._v("MSSQL (TBD if we can get integration tests to run automatically)")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"install"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install","aria-hidden":"true"}},[this._v("#")]),this._v(" Install")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("You need to install "),s("code",[this._v("knex")]),this._v(", database driver and "),s("code",[this._v("knex-db-manager")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("npm install knex-db-manager knex pg pg-escape\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"api-usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-usage","aria-hidden":"true"}},[this._v("#")]),this._v(" API & Usage")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Database manager is initialized with normal "),s("code",[this._v("knex")]),this._v(" configuration and with\nsuperuser account which should be able to create / drop roles and databases.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Initialization:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" config "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  knex"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// just the usual knex configuration")]),t._v("\n    client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'postgres'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    connection"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      host"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      database"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'appdb'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dbowneruser'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      password"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dbownerpassword'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pool"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      min"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      max"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    migrations"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      directory"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" __dirname "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/migrations'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// db manager related configuration")]),t._v("\n    collate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fi_FI.UTF-8'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Finnish_Finland.1252'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    superUser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'userwithrightstocreateusersanddatabases'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    superPassword"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'privilegeduserpassword'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" dbManager "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'knex-db-manager'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("databaseManagerFactory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"createdbownerifnotexist-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#createdbownerifnotexist-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("createDbOwnerIfNotExist(): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Creates the user, which is described in "),s("code",[this._v("knex")]),this._v(" configuration. This user is used as\nthe database owner when creating new databases.")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDbOwnerIfNotExist")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"createdb-dbname-string-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#createdb-dbname-string-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("createDb(dbName?: string): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Creates database described in "),s("code",[this._v("knex")]),this._v(" configuration or by given name. Owner of the\ncreated database is set to be the "),s("code",[this._v("config.knex.connection.user")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("dbName")]),this._v(" is the name of the database to be created, if not given the name is read\nfrom "),s("code",[this._v("config.knex.connection.database")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Read database from "),s("code",[this._v("config.knex.connection.database")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("By given name:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'brave-new-db'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"dropdb-dbname-string-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dropdb-dbname-string-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("dropDb(dbName?: string): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Drops database described in "),s("code",[this._v("knex")]),this._v(" configuration or by given name. Note\nthat if there are any active connections to the database that is being\ndropped, the drop command might fail.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("dbName")]),this._v(" is the name of the database to be dropped, if not given the name\nis read from "),s("code",[this._v("config.knex.connection.database")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Drop database "),s("code",[this._v("config.knex.connection.database")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dropDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("By specific name:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dropDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'brave-new-db'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"copydb-fromdbname-string-todbname-string-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copydb-fromdbname-string-todbname-string-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("copyDb(fromDbName: string, toDbName: string): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("New database "),s("code",[this._v("toDatabaseName")]),this._v(" will be created containing a copy of "),s("code",[this._v("fromDbName")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Making copy of DB:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'brave-new-db'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'brave-new-db-copy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"truncatedb-ignoretables-string-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#truncatedb-ignoretables-string-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("truncateDb(ignoreTables?: string[]): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("ignoreTables")]),this._v(" list of tables names which should not be truncated.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Truncate database "),s("code",[this._v("config.knex.connection.database")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("truncateDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("ignore certain tables:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("truncateDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'migrations'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"updateidsequences-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#updateidsequences-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("updateIdSequences(): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Updates all primary key id sequences to be biggest id in table + 1.\nSo after running this next "),s("code",[this._v("INSERT")]),this._v(" to table will get valid id for\nthe row from the sequence.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("The function assumes that the primary key for each table is called "),s("code",[this._v("id")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Reset sequence of database "),s("code",[this._v("config.knex.connection.database")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateIdSequences")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"populatedb-glob-string-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#populatedb-glob-string-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("populateDb(glob: string): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Finds "),s("code",[this._v("knex")]),this._v(" seed files by pattern and populate database with them.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("glob")]),this._v(" is a pattern to match files to be ran, if not given the name is\nread from "),s("code",[this._v("config.dbManager.populatePathPattern")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Get database from "),s("code",[this._v("config.knex.connection.database")]),this._v(" and pattern\nfrom "),s("code",[this._v("config.dbManager.populatePathPattern")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("populateDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("with pattern:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("populateDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'seeds'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test-*'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"migratedb-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#migratedb-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("migrateDb(): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Runs "),s("code",[this._v("knex")]),this._v(" migrations configured in knex config.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Get database from "),s("code",[this._v("config.knex.connection.database")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("migrateDb")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"dbversion-promise-string"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dbversion-promise-string","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("dbVersion(): Promise<string>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("If no migrations has been run, promise resolves to "),s("code",[this._v("'none'")]),this._v(". Otherwise\nresolves to first numbers of latest migration file ran e.g. for\n"),s("code",[this._v("20141024070315_test_schema.js")]),this._v(" version will be "),s("code",[this._v("'20141024070315'")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Get database from "),s("code",[this._v("config.knex.connection.database")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dbVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"close-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#close-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("close(): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Kill database connection:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"closeknex-promise-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#closeknex-promise-void","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("closeKnex(): Promise<void>")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Close knex connection")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("closeKnex")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"knexinstance-querybuilder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#knexinstance-querybuilder","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("knexInstance(): QueryBuilder")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Returns "),s("code",[this._v("knex")]),this._v(" query builder bound to configured database.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Get database from "),s("code",[this._v("config.knex.connection.database")]),this._v(":")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" knex "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dbManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("knexInstance")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("knex")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'table'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("where")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rows "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Query was ran with db owner privileges'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rows"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])}],!1,null,null,null);s.default=n.exports}}]);